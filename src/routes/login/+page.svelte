<script lang='ts'>
    // SvelteKit utilities and Paraglide imports
    import { enhance } from '$app/forms';
    import { goto } from '$app/navigation';
    import { setLocale } from '$lib/paraglide/runtime';
    import { m } from '$lib/paraglide/messages.js';
    import Lang from '$lib/components/Lang.svelte';    
    
    // Type imports
    import type { ActionData, PageServerData } from './$types';

    // Consolidate data access from the load function (data) and the form action (form)
    let { form, data }: { form: ActionData, data: PageServerData } = $props();

    // State for the password visibility toggle
    let passwordVisible = $state(false);

    // State for the custom modal visibility
    let isModalOpen = $state(false);

    // Function to toggle password visibility
    function togglePasswordVisibility() {
        passwordVisible = !passwordVisible;
    }
</script>


{#if isModalOpen}
<div 
    class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 transition-opacity"
    role="dialog"
    aria-modal="true"
    onclick={() => isModalOpen = false}
    onkeydown={(e) => e.key === 'Escape' && (isModalOpen = false)}
    tabindex="-1"
>
    <div 
        class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100"
        role="document"
        onclick={(e) => e.stopPropagation()}
        onkeydown={(e) => e.stopPropagation()}
    >
        <!-- Modal content -->
    </div>
</div>
{/if}



<!-- Main Login Card -->
<div class="min-h-screen bg-sky-50 flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white p-8 sm:p-10 rounded-3xl shadow-2xl border-t-4 border-teal-500 transform transition duration-500 hover:shadow-3xl">

        <!-- Centered SVG Icon -->
        <div class="flex justify-center mb-6">
            <svg height="100" version="1.1" viewBox="0.0 0.0 960.0 960.0" fill="none" stroke="none" stroke-linecap="square" stroke-miterlimit="10" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><clipPath id="g30a09290263a1024_0.0"><path d="m0 0l960.0 0l0 960.0l-960.0 0l0 -960.0z" clip-rule="nonzero"/></clipPath><g clip-path="url(#g30a09290263a1024_0.0)"><path fill="#000000" fill-opacity="0.0" d="m0 0l960.0 0l0 960.0l-960.0 0z" fill-rule="evenodd"/><path fill="#008be3" d="m432.34268 80.93602l-186.30717 0c-98.938705 0 -179.14436 80.20566 -179.14436 179.14436l0 118.52994l-42.718246 0l70.278915 99.22476l70.278915 -99.22476l-42.718246 0l0 -118.52994l0 0c0 -68.49602 55.526993 -124.023026 124.023026 -124.023026l186.30717 0z" fill-rule="evenodd"/><path fill="#e06666" d="m885.2933 440.1295l0 -182.21835c0 -99.573105 -80.71997 -180.29306 -180.29309 -180.29306l-119.28998 0l0 -42.992165l-99.86102 70.72956l99.86102 70.72956l0 -42.992172l119.28998 0l0 0c68.93524 0 124.8183 55.883057 124.8183 124.81827l0 182.21835z" fill-rule="evenodd"/><path fill="#00b099" d="m65.55302 523.4884l0 182.21832c0 99.57312 80.71996 180.29309 180.29306 180.29309l119.28996 0l0 42.992188l99.86102 -70.72955l-99.86102 -70.729614l0 42.992188l-119.28996 0l0 0c-68.93523 0 -124.818275 -55.883057 -124.818275 -124.8183l0 -182.21832z" fill-rule="evenodd"/><path fill="#ff9900" d="m520.36743 875.00995l186.30713 0c98.93872 0 179.14441 -80.20563 179.14441 -179.14435l0 -118.52991l42.7182 0l-70.27887 -99.22479l-70.27893 99.22479l42.7182 0l0 118.52991l0 0c0 68.49603 -55.526978 124.02301 -124.02301 124.02301l-186.30713 0z" fill-rule="evenodd"/><path fill="#000000" fill-opacity="0.0" d="m260.03046 -79.04462l398.5512 0l0 860.9449l-398.5512 0z" fill-rule="evenodd"/><path fill="#008be3" d="m507.88983 219.1662q48.28125 0 86.546875 24.484375q38.28125 24.484375 60.6875 67.25q22.421875 42.75 22.421875 99.296875q0 56.546875 -22.421875 99.65625q-22.40625 43.109375 -60.0 67.59375q-37.578125 24.46875 -84.46875 24.46875q-27.59375 0 -51.734375 -8.953125q-24.125 -8.96875 -42.40625 -22.765625q-18.28125 -13.796875 -28.28125 -27.921875q-10.0 -14.140625 -10.0 -23.796875l21.390625 -8.96875l0 181.375q0 17.9375 -11.734375 30.0q-11.71875 12.078125 -29.65625 12.078125q-17.921875 0 -29.65625 -11.734375q-11.71875 -11.71875 -11.71875 -30.34375l0 -422.75q0 -17.9375 11.71875 -30.0q11.734375 -12.078125 29.65625 -12.078125q17.9375 0 29.65625 12.078125q11.734375 12.0625 11.734375 30.0l0 33.78125l-11.734375 -6.203125q0 -8.96875 9.65625 -21.71875q9.65625 -12.765625 26.203125 -25.515625q16.5625 -12.765625 38.28125 -21.03125q21.71875 -8.28125 45.859375 -8.28125zm-10.34375 75.859375q-30.34375 0 -53.109375 15.171875q-22.75 15.171875 -35.515625 41.03125q-12.75 25.859375 -12.75 58.96875q0 32.421875 12.75 58.96875q12.765625 26.546875 35.515625 41.71875q22.765625 15.171875 53.109375 15.171875q30.34375 0 52.75 -15.171875q22.421875 -15.171875 35.171875 -41.71875q12.765625 -26.546875 12.765625 -58.96875q0 -33.109375 -12.765625 -58.96875q-12.75 -25.859375 -35.171875 -41.03125q-22.40625 -15.171875 -52.75 -15.171875z" fill-rule="nonzero"/><path fill="#000000" fill-opacity="0.0" d="m-166.74278 967.81366l751.0236 0l0 165.88971l-751.0236 0z" fill-rule="evenodd"/><path fill="#00b099" d="m-108.10216 1028.2587l-20.390625 0l0 36.875l-11.8125 0l0 -36.875l-15.1875 0l0 -11.6875l15.1875 0l0 -15.859375l11.8125 0l0 15.859375l20.390625 0l0 11.6875zm59.73828 4.390625q0 2.4375 -0.859375 5.25q-0.84375 2.796875 -2.75 5.203125q-1.90625 2.40625 -4.984375 4.03125q-3.078125 1.609375 -7.484375 1.609375l-21.0625 0l0 -11.109375l21.0625 0q2.390625 0 3.6875 -1.453125q1.296875 -1.453125 1.296875 -3.609375q0 -2.296875 -1.46875 -3.59375q-1.453125 -1.3125 -3.515625 -1.3125l-21.0625 0q-2.390625 0 -3.6875 1.46875q-1.296875 1.453125 -1.296875 3.609375l0 16.3125q0 2.328125 1.453125 3.640625q1.46875 1.296875 3.625 1.296875l20.96875 0l0 11.140625l-21.0625 0q-2.421875 0 -5.234375 -0.84375q-2.8125 -0.859375 -5.21875 -2.765625q-2.390625 -1.921875 -4.015625 -5.0q-1.609375 -3.078125 -1.609375 -7.46875l0 -16.40625q0 -2.421875 0.84375 -5.21875q0.859375 -2.8125 2.765625 -5.21875q1.90625 -2.40625 4.984375 -4.015625q3.078125 -1.625 7.484375 -1.625l21.0625 0q2.421875 0 5.234375 0.859375q2.8125 0.84375 5.203125 2.765625q2.40625 1.90625 4.015625 4.984375q1.625 3.078125 1.625 7.46875zm54.902344 32.484375l-31.671875 0q-2.421875 0 -5.296875 -0.84375q-2.875 -0.859375 -5.328125 -2.8125q-2.453125 -1.953125 -4.09375 -5.078125q-1.625 -3.125 -1.625 -7.65625l0 -15.8125q0 -1.671875 0.375 -3.515625q0.375 -1.84375 1.1875 -3.65625q0.8125 -1.8125 2.09375 -3.46875q1.28125 -1.671875 3.09375 -2.921875q1.828125 -1.265625 4.203125 -2.03125q2.375 -0.765625 5.390625 -0.765625l31.671875 0l0 11.6875l-31.671875 0q-2.296875 0 -3.484375 1.171875q-1.1875 1.15625 -1.1875 3.578125l0 15.734375q0 2.28125 1.203125 3.5q1.21875 1.203125 3.5625 1.203125l31.578125 0l0 11.6875zm63.660156 0l-11.6875 0l0 -32.203125q0 -2.296875 -1.171875 -3.484375q-1.15625 -1.1875 -3.5 -1.1875l-21.0625 0l0 -11.6875l21.0625 0q1.65625 0 3.5 0.390625q1.84375 0.375 3.65625 1.1875q1.828125 0.796875 3.484375 2.078125q1.671875 1.28125 2.921875 3.109375q1.265625 1.8125 2.03125 4.203125q0.765625 2.375 0.765625 5.390625l0 32.203125zm-42.140625 0l-11.6875 0l0 -69.09375l11.6875 0l0 69.09375zm106.640625 0l-11.671875 0l0 -26.953125q0 -2.296875 -0.796875 -4.109375q-0.78125 -1.828125 -2.140625 -3.125q-1.34375 -1.296875 -3.15625 -1.984375q-1.8125 -0.703125 -3.9375 -0.703125l-20.4375 0l0 36.875l-11.671875 0l0 -42.765625q0 -1.21875 0.4375 -2.265625q0.453125 -1.0625 1.265625 -1.84375q0.8125 -0.78125 1.890625 -1.234375q1.078125 -0.453125 2.28125 -0.453125l26.328125 0q2.203125 0 4.640625 0.5q2.453125 0.484375 4.859375 1.59375q2.40625 1.09375 4.578125 2.78125q2.1875 1.6875 3.875 4.09375q1.6875 2.390625 2.671875 5.546875q0.984375 3.140625 0.984375 7.09375l0 26.953125zm63.07422 -16.390625q0 3.0 -0.765625 5.40625q-0.765625 2.40625 -2.03125 4.234375q-1.25 1.8125 -2.921875 3.09375q-1.65625 1.28125 -3.484375 2.09375q-1.8125 0.796875 -3.671875 1.1875q-1.859375 0.375 -3.53125 0.375l-21.0625 0q-2.421875 0 -5.296875 -0.84375q-2.875 -0.859375 -5.328125 -2.8125q-2.453125 -1.953125 -4.09375 -5.078125q-1.625 -3.125 -1.625 -7.65625l0 -15.8125q0 -4.5 1.625 -7.625q1.640625 -3.125 4.09375 -5.078125q2.453125 -1.953125 5.328125 -2.796875q2.875 -0.859375 5.296875 -0.859375l21.0625 0q4.5 0 7.640625 1.625q3.140625 1.609375 5.078125 4.0625q1.9375 2.4375 2.8125 5.3125q0.875 2.875 0.875 5.359375l0 15.8125zm-11.6875 -15.734375q0 -2.421875 -1.21875 -3.578125q-1.203125 -1.171875 -3.5 -1.171875l-20.96875 0q-2.34375 0 -3.5625 1.1875q-1.203125 1.1875 -1.203125 3.484375l0 15.8125q0 2.28125 1.203125 3.5q1.21875 1.203125 3.5625 1.203125l20.96875 0q2.390625 0 3.546875 -1.203125q1.171875 -1.21875 1.171875 -3.5l0 -15.734375zm42.94336 32.125l-5.203125 0q-2.515625 0 -5.375 -0.84375q-2.84375 -0.859375 -5.3125 -2.8125q-2.46875 -1.953125 -4.09375 -5.078125q-1.609375 -3.125 -1.609375 -7.65625l0 -52.703125l11.671875 0l0 52.703125q0 2.15625 1.34375 3.4375q1.359375 1.265625 3.375 1.265625l5.203125 0l0 11.6875zm60.33986 -16.390625q0 3.0 -0.765625 5.40625q-0.765625 2.40625 -2.03125 4.234375q-1.25 1.8125 -2.921875 3.09375q-1.65625 1.28125 -3.484375 2.09375q-1.8125 0.796875 -3.671875 1.1875q-1.859375 0.375 -3.53125 0.375l-21.062515 0q-2.421875 0 -5.296875 -0.84375q-2.875 -0.859375 -5.328125 -2.8125q-2.453125 -1.953125 -4.09375 -5.078125q-1.625 -3.125 -1.625 -7.65625l0 -15.8125q0 -4.5 1.625 -7.625q1.640625 -3.125 4.09375 -5.078125q2.453125 -1.953125 5.328125 -2.796875q2.875 -0.859375 5.296875 -0.859375l21.062515 0q4.5 0 7.640625 1.625q3.140625 1.609375 5.078125 4.0625q1.9375 2.4375 2.8125 5.3125q0.875 2.875 0.875 5.359375l0 15.8125zm-11.6875 -15.734375q0 -2.421875 -1.21875 -3.578125q-1.203125 -1.171875 -3.5 -1.171875l-20.968765 0q-2.34375 0 -3.5625 1.1875q-1.203125 1.1875 -1.203125 3.484375l0 15.8125q0 2.28125 1.203125 3.5q1.21875 1.203125 3.5625 1.203125l20.968765 0q2.390625 0 3.546875 -1.203125q1.171875 -1.21875 1.171875 -3.5l0 -15.734375zm74.44336 36.796875q0 3.015625 -0.765625 5.40625q-0.765625 2.40625 -2.03125 4.21875q-1.25 1.828125 -2.921875 3.109375q-1.65625 1.28125 -3.484375 2.09375q-1.8125 0.8125 -3.671875 1.1875q-1.859375 0.375 -3.53125 0.375l-21.0625 0l0 -11.671875l21.0625 0q2.390625 0 3.546875 -1.21875q1.171875 -1.203125 1.171875 -3.5l0 -36.875q0 -2.296875 -1.171875 -3.484375q-1.15625 -1.1875 -3.546875 -1.1875l-21.0625 0q-2.15625 0 -3.421875 1.328125q-1.25 1.3125 -1.25 3.34375l0 15.8125q0 2.28125 1.203125 3.5q1.21875 1.203125 3.5625 1.203125l20.96875 0l0 11.6875l-21.0625 0q-1.65625 0 -3.5 -0.375q-1.84375 -0.390625 -3.671875 -1.1875q-1.8125 -0.8125 -3.484375 -2.09375q-1.65625 -1.28125 -2.921875 -3.09375q-1.25 -1.828125 -2.015625 -4.234375q-0.75 -2.40625 -0.75 -5.40625l0 -15.8125q0 -1.671875 0.375 -3.515625q0.375 -1.84375 1.1875 -3.65625q0.8125 -1.8125 2.09375 -3.46875q1.28125 -1.671875 3.09375 -2.921875q1.828125 -1.265625 4.203125 -2.03125q2.375 -0.765625 5.390625 -0.765625l21.0625 0q1.671875 0 3.53125 0.390625q1.859375 0.375 3.671875 1.1875q1.828125 0.796875 3.484375 2.078125q1.671875 1.28125 2.921875 3.109375q1.265625 1.8125 2.03125 4.203125q0.765625 2.375 0.765625 5.390625l0 36.875zm22.550781 -63.203125l-11.6875 0l0 -10.5625l11.6875 0l0 10.5625zm0 58.53125l-11.6875 0l0 -48.5625l11.6875 0l0 48.5625zm63.41992 -32.484375q0 2.4375 -0.859375 5.25q-0.84375 2.796875 -2.75 5.203125q-1.90625 2.40625 -4.984375 4.03125q-3.078125 1.609375 -7.484375 1.609375l-21.0625 0l0 -11.109375l21.0625 0q2.390625 0 3.6875 -1.453125q1.296875 -1.453125 1.296875 -3.609375q0 -2.296875 -1.46875 -3.59375q-1.453125 -1.3125 -3.515625 -1.3125l-21.0625 0q-2.390625 0 -3.6875 1.46875q-1.296875 1.453125 -1.296875 3.609375l0 16.3125q0 2.328125 1.453125 3.640625q1.46875 1.296875 3.625 1.296875l20.96875 0l0 11.140625l-21.0625 0q-2.421875 0 -5.234375 -0.84375q-2.8125 -0.859375 -5.21875 -2.765625q-2.390625 -1.921875 -4.015625 -5.0q-1.609375 -3.078125 -1.609375 -7.46875l0 -16.40625q0 -2.421875 0.84375 -5.21875q0.859375 -2.8125 2.765625 -5.21875q1.90625 -2.40625 4.984375 -4.015625q3.078125 -1.625 7.484375 -1.625l21.0625 0q2.421875 0 5.234375 0.859375q2.8125 0.84375 5.203125 2.765625q2.40625 1.90625 4.015625 4.984375q1.625 3.078125 1.625 7.46875zm54.808594 16.09375q0 3.0 -0.765625 5.40625q-0.765625 2.40625 -2.03125 4.234375q-1.25 1.8125 -2.90625 3.09375q-1.65625 1.28125 -3.484375 2.09375q-1.8125 0.796875 -3.6875 1.1875q-1.859375 0.375 -3.515625 0.375l-31.625 0l0 -11.6875l31.53125 0q2.375 0 3.59375 -1.203125q1.21875 -1.21875 1.21875 -3.5q-0.234375 -4.671875 -4.71875 -4.671875l-18.109375 0q-3.859375 0 -6.5625 -1.34375q-2.6875 -1.359375 -4.375 -3.375q-1.6875 -2.03125 -2.4375 -4.359375q-0.734375 -2.34375 -0.734375 -4.359375q0 -3.90625 1.390625 -6.578125q1.40625 -2.671875 3.515625 -4.328125q2.109375 -1.671875 4.578125 -2.40625q2.46875 -0.75 4.625 -0.75l28.703125 0l0 11.6875l-28.609375 0q-0.90625 0 -1.421875 0.203125q-0.515625 0.1875 -0.765625 0.53125q-0.234375 0.34375 -0.28125 0.71875q-0.046875 0.375 -0.046875 0.734375q0.046875 0.71875 0.265625 1.125q0.234375 0.40625 0.5625 0.59375q0.34375 0.171875 0.765625 0.203125q0.421875 0.015625 0.828125 0.015625l18.109375 0q4.484375 0 7.625 1.625q3.15625 1.609375 5.078125 4.0625q1.9375 2.4375 2.8125 5.3125q0.875 2.875 0.875 5.359375z" fill-rule="nonzero"/></g></svg>

        </div>

        <Lang />
    
        <h1 class="mt-8 text-3xl font-extrabold text-gray-800 text-center mb-1">{m.welcome()}</h1>
        <p class="text-center text-gray-500 mb-8">{m.sign_in_to_account()}</p>

        <!-- Display Server Message/Error -->
        {#if form?.message}
            <p class="text-sm bg-red-100 text-red-600 p-3 rounded-lg border border-red-300 mb-4 animate-pulse">
                {form.message}
            </p>
        {/if}

        <form method="post" action="?/login" use:enhance class="space-y-6">
            <!-- Username Field -->
            <label class="block">
                <span class="text-gray-700 font-medium">Username</span>
                <input 
                    name="username" 
                    placeholder="{m.enter_username()}"
                    class="mt-1 block w-full px-4 py-2 bg-sky-50 border border-sky-200 rounded-xl shadow-inner text-gray-800
                           focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-150"
                />
            </label>

            <!-- Password Field with Visibility Toggle -->
            <label class="block">
                <span class="text-gray-700 font-medium">Password</span>
                <div class="relative mt-1">
                    <input 
                        type={passwordVisible ? 'text' : 'password'} 
                        name="password"
                        placeholder="••••••••"
                        class="block w-full pr-12 px-4 py-2 bg-sky-50 border border-sky-200 rounded-xl shadow-inner text-gray-800
                               focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-150"
                    />
                    <button 
                        type="button" 
                        class="absolute inset-y-0 right-0 flex items-center px-4 text-gray-400 hover:text-teal-500 transition"
                        onclick={togglePasswordVisibility}
                        aria-label={passwordVisible ? 'Hide password' : 'Show password'}
                    >
                        {#if passwordVisible}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.638 0-8.406-2.583-11.85-6.071m-.151-.013L2.43 11.2m.112-1.127l1.011-1.011m1.127-.112l1.011-1.011m1.127-.112l1.011-1.011m1.127-.112l1.011-1.011m1.127-.112l1.011-1.011m1.127-.112l1.011-1.011M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7a2 2 0 00-2-2h-5.586a1 1 0 00-.707.293l-4.586 4.586A2 2 0 005 11.414V17a2 2 0 002 2h8a2 2 0 002-2v-5.586a1 1 0 00-.293-.707l-4.586-4.586A2 2 0 0013.414 7H18z" />
                            </svg>
                        {:else}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        {/if}
                    </button>
                </div>
            </label>

            <!-- Forgot Password Link -->
            <div class="flex justify-end text-sm">
                <!-- <a 
                    href="#" 
                    onclick="event.preventDefault(); isModalOpen = true"
                    class="font-semibold text-sky-600 hover:text-teal-500 transition duration-150"
                >
                    Forgot Password?
                </a> -->
            </div>

            <!-- Login Button -->
            <button 
                class="w-full bg-teal-600 text-white font-bold px-4 py-3 rounded-xl shadow-lg hover:bg-teal-700 
                       focus:outline-none focus:ring-4 focus:ring-teal-300 transition duration-150 transform hover:scale-[1.01]"
                >
                {m.sign_in()}
            </button>

            <!-- Register Link/Button -->
            <div class="text-center pt-2">
                <p class="text-sm text-gray-600">
                        {m.no_account()}
                    <a href="/register" class="font-semibold text-sky-600 hover:text-teal-500 transition duration-150">
                        {m.register_here()}
                    </a>
                </p>
            </div>
        </form>
    </div>
</div>

